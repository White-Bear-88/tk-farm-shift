<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† - é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 0 2px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:hover { opacity: 0.8; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-unconfirmed { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d4edda; color: #155724; }
        .status-disabled { background: #f8d7da; color: #721c24; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .message {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h1>
            <div>
                <button class="btn btn-secondary" onclick="location.href='menu.html'">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="loadUsers()">æ›´æ–°</button>
            </div>
        </div>

        <div id="message" class="message"></div>
        
        <div id="loading" class="loading">
            ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
        </div>

        <div id="userTable" style="display: none;">
            <table>
                <thead>
                    <tr>
                        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                        <th>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
                        <th>åå‰</th>
                        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>æœ‰åŠ¹/ç„¡åŠ¹</th>
                        <th>ä½œæˆæ—¥</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://mxh6g7opm2.execute-api.ap-northeast-1.amazonaws.com/dev';

        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
        });

        async function loadUsers() {
            const loading = document.getElementById('loading');
            const userTable = document.getElementById('userTable');
            
            loading.style.display = 'block';
            userTable.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE_URL}/cognito-admin/users`);
                
                if (!response.ok) {
                    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                displayUsers(data.users);
                
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
                userTable.style.display = 'block';
            }
        }

        function displayUsers(users) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                
                const email = user.attributes.email || '';
                const name = user.attributes.name || '';
                const createdDate = new Date(user.created_date).toLocaleDateString('ja-JP');
                
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${email}</td>
                    <td>${name}</td>
                    <td><span class="status-badge status-${user.user_status.toLowerCase()}">${getStatusText(user.user_status)}</span></td>
                    <td><span class="status-badge ${user.enabled ? 'status-confirmed' : 'status-disabled'}">${user.enabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</span></td>
                    <td>${createdDate}</td>
                    <td>${getActionButtons(user)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getStatusText(status) {
            const statusMap = {
                'UNCONFIRMED': 'æœªæ‰¿èª',
                'CONFIRMED': 'æ‰¿èªæ¸ˆã¿',
                'ARCHIVED': 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–',
                'COMPROMISED': 'ä¾µå®³',
                'UNKNOWN': 'ä¸æ˜',
                'RESET_REQUIRED': 'ãƒªã‚»ãƒƒãƒˆå¿…è¦',
                'FORCE_CHANGE_PASSWORD': 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¿…è¦'
            };
            return statusMap[status] || status;
        }

        function getActionButtons(user) {
            let buttons = '';
            
            if (user.user_status === 'UNCONFIRMED') {
                buttons += `<button class="btn btn-success" onclick="approveUser('${user.username}')">æ‰¿èª</button>`;
                buttons += `<button class="btn btn-danger" onclick="rejectUser('${user.username}')">æ‹’å¦</button>`;
            }
            
            if (user.user_status === 'CONFIRMED') {
                if (user.enabled) {
                    buttons += `<button class="btn btn-warning" onclick="disableUser('${user.username}')">ç„¡åŠ¹åŒ–</button>`;
                } else {
                    buttons += `<button class="btn btn-success" onclick="enableUser('${user.username}')">æœ‰åŠ¹åŒ–</button>`;
                }
            }
            
            return buttons;
        }

        async function approveUser(username) {
            if (!confirm(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ "${username}" ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/cognito-admin/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‰¿èªã—ã¾ã—ãŸ', 'success');
                    loadUsers();
                } else {
                    throw new Error(result.error || 'æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                showMessage('æ‰¿èªã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        async function rejectUser(username) {
            if (!confirm(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ "${username}" ã‚’æ‹’å¦ã—ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/cognito-admin/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹’å¦ã—ã¾ã—ãŸ', 'success');
                    loadUsers();
                } else {
                    throw new Error(result.error || 'æ‹’å¦ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                showMessage('æ‹’å¦ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        async function disableUser(username) {
            if (!confirm(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ "${username}" ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/cognito-admin/disable`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ', 'success');
                    loadUsers();
                } else {
                    throw new Error(result.error || 'ç„¡åŠ¹åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                showMessage('ç„¡åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        async function enableUser(username) {
            if (!confirm(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ "${username}" ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/cognito-admin/enable`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸ', 'success');
                    loadUsers();
                } else {
                    throw new Error(result.error || 'æœ‰åŠ¹åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                showMessage('æœ‰åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>