<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ã‚°ã‚¤ãƒ³ - é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 400px;
            max-width: 90%;
            text-align: center;
        }
        .login-header h1 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        .login-header p {
            color: #666;
            margin: 0 0 30px 0;
        }
        .login-method {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .login-method h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .divider {
            margin: 30px 0;
            text-align: center;
            position: relative;
        }
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }
        .divider span {
            background: white;
            padding: 0 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1>ğŸ„ ãƒ­ã‚°ã‚¤ãƒ³</h1>
            <p>é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="login-method">
            <h3>CogniteID ã§ãƒ­ã‚°ã‚¤ãƒ³</h3>
            <button class="btn btn-primary" onclick="startCogniteLogin()">
                ãƒ­ã‚°ã‚¤ãƒ³
            </button>
        </div>
        
        <div class="divider" id="devDivider" style="display: none;">
            <span>é–‹ç™ºç”¨</span>
        </div>
        
        <div class="login-method" id="devLogin" style="display: none;">
            <h3>é–‹ç™ºç”¨ãƒ­ã‚°ã‚¤ãƒ³</h3>
            <button class="btn btn-secondary" onclick="location.href='login-dev.html'">
                é–‹ç™ºç”¨ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
            </button>
        </div>
    </div>

    <script src="cognite-auth-config.js"></script>
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é–‹ç™ºç’°å¢ƒã§ã®ã¿é–‹ç™ºç”¨ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡¨ç¤º
            if (isDevelopmentMode()) {
                document.getElementById('devDivider').style.display = 'block';
                document.getElementById('devLogin').style.display = 'block';
            }
        });
        
        function startCogniteLogin() {
            const config = getCogniteConfig();
            
            // CSRFå¯¾ç­–ç”¨ã®stateã¨nonceã‚’ç”Ÿæˆ
            const state = generateRandomString(32);
            const nonce = generateRandomString(32);
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            sessionStorage.setItem('cognite_auth_state', state);
            sessionStorage.setItem('cognite_auth_nonce', nonce);
            
            // CogniteIDèªè¨¼ URLã‚’æ§‹ç¯‰
            const authUrl = new URL(`https://${config.TENANT_DOMAIN}/oauth2/authorize`);
            authUrl.searchParams.set('client_id', config.CLIENT_ID);
            authUrl.searchParams.set('response_type', config.RESPONSE_TYPE);
            authUrl.searchParams.set('scope', config.SCOPE);
            authUrl.searchParams.set('redirect_uri', config.REDIRECT_URI);
            authUrl.searchParams.set('state', state);
            authUrl.searchParams.set('nonce', nonce);
            
            // CogniteIDãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            window.location.href = authUrl.toString();
        }
        
        function loginWithCogniteID() {
            const config = getCogniteConfig();
            
            // èªè¨¼URLã‚’æ§‹ç¯‰
            const authUrl = new URL(`${config.cogniteDomain}/oauth2/authorize`);
            authUrl.searchParams.set('client_id', config.clientId);
            authUrl.searchParams.set('response_type', 'code');
            authUrl.searchParams.set('scope', config.scope);
            authUrl.searchParams.set('redirect_uri', config.redirectUri);
            
            // çŠ¶æ…‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç”Ÿæˆï¼ˆCSRFå¯¾ç­–ï¼‰
            const state = generateRandomString(32);
            localStorage.setItem('cognite_auth_state', state);
            authUrl.searchParams.set('state', state);
            
            // CogniteIDãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            window.location.href = authUrl.toString();
        }
        
        function generateRandomString(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
    </script>
</body>
</html>