<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€é–‹ç™ºç”¨ã€‘ãƒ­ã‚°ã‚¤ãƒ³ - é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            background: repeating-linear-gradient(
                45deg,
                #ff6b35,
                #ff6b35 10px,
                #ff8c42 10px,
                #ff8c42 20px
            );
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.1);
            z-index: 1;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 400px;
            max-width: 90%;
            border: 3px solid #ff6b35;
            position: relative;
            z-index: 2;
        }
        .dev-warning {
            background: #ff6b35;
            color: white;
            padding: 10px;
            margin: -40px -40px 20px -40px;
            border-radius: 12px 12px 0 0;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h1 {
            color: #ff6b35;
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        .login-header p {
            color: #666;
            margin: 0;
        }
        .form-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .demo-note {
            background: #fff3cd;
            border: 2px solid #ff6b35;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 14px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="dev-warning">
            âš ï¸ DEVELOPMENT MODE ONLY âš ï¸
        </div>
        
        <div class="login-header">
            <h1>ğŸ„ ã€é–‹ç™ºç”¨ã€‘ãƒ­ã‚°ã‚¤ãƒ³</h1>
            <p>é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <label>CogniteID ã¾ãŸã¯ å¾“æ¥­å“¡ID:</label>
                <input type="text" id="userId" required placeholder="ä¾‹: usr12345678 ã¾ãŸã¯ 001" value="usr7wyygjep">
            </div>
            
            <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>

        <div class="demo-note">
            <strong>âš ï¸ é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ãƒ­ã‚°ã‚¤ãƒ³:</strong><br>
            CogniteIDï¼ˆä¾‹: usr12345678ï¼‰ã¾ãŸã¯å¾“æ¥­å“¡IDï¼ˆä¾‹: 001ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
            <strong>æœ¬ç•ªç’°å¢ƒã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚</strong>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¢ç”¨JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
        function createDemoToken(username, groups) {
            const header = {
                "alg": "HS256",
                "typ": "JWT"
            };
            
            const payload = {
                "sub": username,
                "username": username,
                "cognito:groups": groups,
                "email": `${username}@example.com`,
                "iat": Math.floor(Date.now() / 1000),
                "exp": Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24æ™‚é–“å¾Œ
            };
            
            // Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¢ç”¨ãªã®ã§ç½²åã¯çœç•¥ï¼‰
            const encodedHeader = btoa(JSON.stringify(header));
            const encodedPayload = btoa(JSON.stringify(payload));
            
            return `${encodedHeader}.${encodedPayload}.demo_signature`;
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value.trim();
            
            if (!userId) {
                alert('CogniteIDã¾ãŸã¯å¾“æ¥­å“¡IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
                const user = await findUser(userId);
                if (!user) {
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                if (!user.is_active) {
                    alert('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
                
                // ãƒ­ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®š
                const groups = user.role === 'admin' ? ['admin', 'employee'] : ['employee'];
                const token = createDemoToken(user.cognite_user_id, groups);
                
                // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
                localStorage.setItem('cognito_token', token);
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = 'menu.html';
            } catch (error) {
                console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        });
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢é–¢æ•°
        async function findUser(userId) {
            const API_BASE_URL = 'https://mxh6g7opm2.execute-api.ap-northeast-1.amazonaws.com/dev';
            
            try {
                // CogniteIDã§ç›´æ¥æ¤œç´¢
                if (userId.startsWith('usr')) {
                    const response = await fetch(`${API_BASE_URL}/cognite-users/${userId}`);
                    if (response.ok) {
                        return await response.json();
                    }
                }
                
                // å¾“æ¥­å“¡IDã§æ¤œç´¢ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰è©²å½“è€…ã‚’æ¢ã™ï¼‰
                const response = await fetch(`${API_BASE_URL}/cognite-users`);
                if (response.ok) {
                    const users = await response.json();
                    return users.find(user => user.employee_id === userId);
                }
                
                return null;
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
                return null;
            }
        }
    </script>
</body>
</html>