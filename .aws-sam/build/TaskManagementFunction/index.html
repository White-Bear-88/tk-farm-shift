<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, select, button { padding: 8px; margin: 5px 0; }
        button { background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .shift-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; }
        .shift-item { padding: 10px; border: 1px solid #ccc; border-radius: 3px; background: #f9f9f9; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ„ é…ªè¾²ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <div class="section">
            <h2>ã‚·ãƒ•ãƒˆä½œæˆ</h2>
            <form id="createShiftForm">
                <div class="form-group">
                    <label>æ—¥ä»˜:</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label>å¾“æ¥­å“¡ID:</label>
                    <input type="text" id="employeeId" placeholder="001" required>
                </div>
                <div class="form-group">
                    <label>ä½œæ¥­ç¨®åˆ¥:</label>
                    <select id="taskType" required>
                        <option value="milking">æ¾ä¹³</option>
                        <option value="feeding">çµ¦é¤Œ</option>
                        <option value="cleaning">æ¸…æƒ</option>
                        <option value="patrol">è¦‹å›ã‚Š</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é–‹å§‹æ™‚é–“:</label>
                    <input type="time" id="startTime" required>
                </div>
                <div class="form-group">
                    <label>çµ‚äº†æ™‚é–“:</label>
                    <input type="time" id="endTime" required>
                </div>
                <button type="submit">ã‚·ãƒ•ãƒˆä½œæˆ</button>
            </form>
            <div id="createMessage"></div>
        </div>

        <div class="section">
            <h2>ã‚·ãƒ•ãƒˆæ¤œç´¢</h2>
            <div class="form-group">
                <label>æ¤œç´¢æ—¥ä»˜:</label>
                <input type="date" id="searchDate">
                <button onclick="searchShifts()">æ¤œç´¢</button>
            </div>
            <div id="shiftResults" class="shift-list"></div>
        </div>

        <div class="section">
            <h2>è‡ªå‹•ã‚·ãƒ•ãƒˆå‰²ã‚Šå½“ã¦</h2>
            <form id="autoAssignForm">
                <div class="form-group">
                    <label>å‰²ã‚Šå½“ã¦æ—¥ä»˜:</label>
                    <input type="date" id="assignDate" required>
                </div>
                <div class="form-group">
                    <label>æ¾ä¹³æ‹…å½“è€…æ•°:</label>
                    <input type="number" id="milkingCount" value="2" min="1">
                </div>
                <div class="form-group">
                    <label>çµ¦é¤Œæ‹…å½“è€…æ•°:</label>
                    <input type="number" id="feedingCount" value="1" min="1">
                </div>
                <button type="submit">è‡ªå‹•å‰²ã‚Šå½“ã¦</button>
            </form>
            <div id="assignMessage"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://mxh6g7opm2.execute-api.ap-northeast-1.amazonaws.com/dev';

        // ã‚·ãƒ•ãƒˆä½œæˆ
        document.getElementById('createShiftForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                date: document.getElementById('date').value,
                employee_id: document.getElementById('employeeId').value,
                task_type: document.getElementById('taskType').value,
                start_time: document.getElementById('startTime').value,
                end_time: document.getElementById('endTime').value
            };

            try {
                const response = await fetch(`${API_BASE}/shifts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('createMessage').innerHTML = 
                    `<div class="success">${result.message}</div>`;
                document.getElementById('createShiftForm').reset();
            } catch (error) {
                document.getElementById('createMessage').innerHTML = 
                    `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        });

        // ã‚·ãƒ•ãƒˆæ¤œç´¢
        async function searchShifts() {
            const date = document.getElementById('searchDate').value;
            if (!date) return;

            try {
                const response = await fetch(`${API_BASE}/shifts/by-date/${date}`);
                const shifts = await response.json();
                
                const resultsDiv = document.getElementById('shiftResults');
                if (shifts.length === 0) {
                    resultsDiv.innerHTML = '<p>è©²å½“ã™ã‚‹ã‚·ãƒ•ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    return;
                }

                resultsDiv.innerHTML = shifts.map(shift => `
                    <div class="shift-item">
                        <strong>å¾“æ¥­å“¡: ${shift.employee_id}</strong><br>
                        ä½œæ¥­: ${getTaskName(shift.task_type)}<br>
                        æ™‚é–“: ${shift.start_time} - ${shift.end_time}<br>
                        çŠ¶æ…‹: ${shift.status}
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('shiftResults').innerHTML = 
                    `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        // è‡ªå‹•ã‚·ãƒ•ãƒˆå‰²ã‚Šå½“ã¦
        document.getElementById('autoAssignForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                date: document.getElementById('assignDate').value,
                required_tasks: [
                    { task_type: 'milking', count: parseInt(document.getElementById('milkingCount').value) },
                    { task_type: 'feeding', count: parseInt(document.getElementById('feedingCount').value) }
                ]
            };

            try {
                const response = await fetch(`${API_BASE}/shifts/assign`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('assignMessage').innerHTML = 
                    `<div class="success">${result.message}</div>`;
            } catch (error) {
                document.getElementById('assignMessage').innerHTML = 
                    `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        });

        function getTaskName(taskType) {
            const names = {
                'milking': 'æ¾ä¹³',
                'feeding': 'çµ¦é¤Œ', 
                'cleaning': 'æ¸…æƒ',
                'patrol': 'è¦‹å›ã‚Š'
            };
            return names[taskType] || taskType;
        }

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’åˆæœŸå€¤ã«è¨­å®š
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        document.getElementById('searchDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('assignDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>